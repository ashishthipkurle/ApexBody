<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Password reset redirect</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:24px;color:#222}
    .card{max-width:680px;margin:48px auto;padding:20px;border-radius:10px;border:1px solid #eee;background:#fff}
  </style>
</head>
<body>
  <div class="card">
    <h2>Redirecting to the app...</h2>
    <p>If you are not redirected automatically, open the app or paste the link into your app's reset screen.</p>
  </div>
  <script>
    // Extract fragment (after #) and turn it into a query param for app scheme
    (function(){
      var frag = window.location.hash ? window.location.hash.substring(1) : '';
      if (!frag) {
        document.querySelector('h2').textContent = 'No token found in the URL.';
        return;
      }
      try {
        var params = new URLSearchParams(frag);
        var token = params.get('access_token');
        if (!token) {
          document.querySelector('h2').textContent = 'No access token found in the URL fragment.';
          return;
        }
        var appUrl = 'apexbody://reset?access_token=' + encodeURIComponent(token);
        // Use replace so back button doesn't return here
        window.location.replace(appUrl);
      } catch (e) {
        document.querySelector('h2').textContent = 'Error processing token.';
        console.error(e);
      }
    })();
  </script>
</body>
</html>
